@page
@model sisnet.Pages.IndexModel
@{
    ViewData["Title"] = "SISNET";
}

<div class="search-page-container">
    <div class="search-bar-container">
        <span class="sisnet">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-audio-lines"><path d="M2 10v3" /><path d="M6 6v11" /><path d="M10 3v18" /><path d="M14 8v7" /><path d="M18 5v13" /><path d="M22 10v3" /></svg>
            SISNET
        </span>
        <h1>Hear it. Love it. Find it fast.</h1>
        <div class="search-input-container">
            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8" /><line x1="21" y1="21" x2="16.65" y2="16.65" /></svg>
            <input type="text" id="searchBox" class="search-box" placeholder="Track name, artist name..." oninput="searchSongs(1)" />
        </div>
    </div>
    <div class="results-container">
        <div class="filters">
            <h2>Filters</h2>
        </div>
        <div class="search-results">
            <ul id="results"></ul>
            <div class="pagination-controls">
                <button id="prevPage" onclick="changePage(-1)">Anterior</button>
                <button id="nextPage" onclick="changePage(1)">Siguiente</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        let currentPage = 1;

        document.addEventListener('DOMContentLoaded', function () {
            searchSongs();
        });

        async function searchSongs(newPage) {
            const query = document.getElementById('searchBox').value.trim();
            const pageSize = 10;
            currentPage = newPage;
            let response;

            if (query !== '') {
                response = await fetch(`/Index?handler=SearchSongs&query=${query}&currentPage=${currentPage}&pageSize=${pageSize}`);
            } else {
                response = await fetch(`/Index?handler=TrendingSongs`);
            }

            const results = await response.json();
            const resultsList = document.getElementById('results');
            resultsList.innerHTML = '';

            results.forEach(song => {
                const li = document.createElement('li');
                li.innerHTML = `<div class="song-info">
                                    <svg class="play-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-music-2"><circle cx="8" cy="18" r="4"/><path d="M12 18V2l7 4"/></svg>
                                    <div class="song-details">
                                        <span class="track-name">${song.track_Name}</span>
                                        <span class="artist-name">${song.artist_Name}</span>
                                    </div>
                                </div>
                                <span class="duration">${song.duration_ms}</span>`;
                resultsList.appendChild(li);
            });

            document.getElementById('prevPage').disabled = currentPage <= 1 || query === '';
            document.getElementById('nextPage').disabled = results.length < pageSize || currentPage > 5 || query === '';
        }

        function changePage(delta) {
            currentPage += delta;
            searchSongs(currentPage);
        }
    </script>
}
